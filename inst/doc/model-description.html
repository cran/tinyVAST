<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="James T. Thorson" />


<title>tinyVAST model description</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">tinyVAST model description</h1>
<h4 class="author">James T. Thorson</h4>


<div id="TOC">
<ul>
<li><a href="#bivariate-generalized-linear-mixed-model-structure" id="toc-bivariate-generalized-linear-mixed-model-structure">Bivariate
generalized linear mixed model structure</a></li>
<li><a href="#spatial-domains" id="toc-spatial-domains">Spatial
domains</a></li>
<li><a href="#structural-equation-models" id="toc-structural-equation-models">Structural equation models</a></li>
<li><a href="#dynamic-structural-equation-models" id="toc-dynamic-structural-equation-models">Dynamic structural equation
models</a></li>
<li><a href="#spatial-interactions-for-sem-and-dsem" id="toc-spatial-interactions-for-sem-and-dsem">Spatial interactions for
SEM and DSEM</a></li>
<li><a href="#generalized-additive-model" id="toc-generalized-additive-model">Generalized additive model</a></li>
</ul>
</div>

<!-- math bold nonitalic -->
<!-- math nonitalic -->
<div id="bivariate-generalized-linear-mixed-model-structure" class="section level1">
<h1>Bivariate generalized linear mixed model structure</h1>
<p>tinyVAST is a bivariate extension of a generalized linear mixed model
(see Tables 1 and 2 for notation), which includes two linear predictors
that each include four additive components:</p>
<ol style="list-style-type: decimal">
<li><p><em>Spatial interactions among variables</em>: The user can
specify interactions among variables at a given site (or for spatially
correlated latent variables) using arrow notation derived from path
analysis, based on the interface from R package sem;</p></li>
<li><p><em>Temporal interaction among variables</em>: The user can
specify simultaneous and lagged interactions among variables over time
using an expanded arrow-and-lag notation that is derived from R package
dsem, where these interactions the annual intercept for a given variable
therefore apply uniformly for all locations.</p></li>
<li><p><em>Spatio-temporal interactions among variables</em>: The user
can specify simultaneous and lagged interactions among variables over
time, where these interactions occur on a site-by-site basis.</p></li>
<li><p><em>Generalized additive model</em>: The user specifies a formula
for a generalized additive model (GAM) that is interpreted by R package
mgcv. If other model components are missing, tinyVAST estimates
parameters that are similar to mgcv, with small differences resulting
from different methods for parameter estimation;</p></li>
</ol>
<p>These four components are assembled into two linear predictors:</p>
<p><span class="math display">\[
\begin{aligned}
p_{\mathrm 1,i} &amp;= \underbrace{\mathbf X_{\mathrm 1,i}
\mathbf\alpha_{\mathrm 1} + \mathbf Z_{\mathrm 1,i}
\mathbf\gamma_{\mathrm 1}}_\text{GAM} + \underbrace{\mathbf A_{i}
\mathbf\Omega_{\mathrm 1,c[i]}}_\text{space_term} + \underbrace{\mathbf
D_{\mathrm 1,c[i],t[i]}}_\text{time_term} + \underbrace{\mathbf A_i
\mathbf E_{\mathrm 1,c[i],t[i]}}_\text{spacetime_term}  \\
p_{\mathrm 2,i} &amp;= \underbrace{\mathbf X_{\mathrm 2,i}
\mathbf\alpha_{\mathrm 2} + \mathbf Z_{\mathrm 2,i}
\mathbf\gamma_{\mathrm 2}}_\text{GAM} + \underbrace{\mathbf A_{i}
\mathbf\Omega_{\mathrm 2,c[i]}}_\text{space_term} + \underbrace{\mathbf
D_{\mathrm 2,c[i],t[i]}}_\text{time_term} + \underbrace{\mathbf A_i
\mathbf E_{\mathrm 2,c[i],t[i]}}_\text{spacetime_term}
\end{aligned}
\]</span></p>
<p>where</p>
<ul>
<li><span class="math inline">\(p_{\mathrm 1,i}\)</span> is the first
linear predictor;</li>
<li><span class="math inline">\(\mathbf X_{\mathrm 1,i}
\mathbf\alpha_{\mathrm 1} + \mathbf Z_{\mathrm 1,i}
\mathbf\gamma_{\mathrm 1}\)</span> is the GAM component</li>
<li><span class="math inline">\(\mathbf\alpha_{\mathrm 1}\)</span> is
the GAM fixed effects with associated design matrix <span class="math inline">\(\mathbf X_{\mathrm 1}\)</span>, where <span class="math inline">\(\mathbf X_{\mathrm 1,i}\)</span> is the row of the
design matrix for sample <span class="math inline">\(i\)</span>;</li>
<li><span class="math inline">\(\mathbf\gamma_{\mathrm 1}\)</span> is
the GAM random effects with associated design matrix <span class="math inline">\(\mathbf Z\)</span>, where <span class="math inline">\(\mathbf Z_{\mathrm 1,i}\)</span> is the row of the
design matrix;</li>
<li><span class="math inline">\(\mathbf A_{i} \mathbf\Omega_{\mathrm
1,c[i]}\)</span> is the projection of the space-veriable interaction
<span class="math inline">\(\mathbf\Omega\)</span> to sample <span class="math inline">\(i\)</span>, where <span class="math inline">\(\mathbf A\)</span> is the interpolation matrix
with dimension <span class="math inline">\(I \times S\)</span> such that
row <span class="math inline">\(\mathbf A_{i}\)</span> interpolates
spatial vector <span class="math inline">\(\mathbf\Omega_{\mathrm
1,c[i]}\)</span> for sample <span class="math inline">\(i\)</span> and
variable <span class="math inline">\(c[i]\)</span>;</li>
<li><span class="math inline">\(\mathbf D_{\mathrm 1,c[i],t[i]}\)</span>
is the time-variable interaction <span class="math inline">\(\mathbf
D\)</span> for sample <span class="math inline">\(i\)</span>;</li>
<li><span class="math inline">\(\mathbf A_i \mathbf E_{\mathrm
1,c[i],t[i]}\)</span> is the projection of the space-variable-time
interaction <span class="math inline">\(\mathbf E\)</span> to sample
<span class="math inline">\(i\)</span>;</li>
</ul>
<p>and terms are defined similarly for the second linear predictor <span class="math inline">\(p_{\mathrm 2,i}\)</span> except using subscript-2.
The linear predictors are then passed through a bivariate inverse-link
function to specify the distribution for errors:</p>
<p><span class="math display">\[
y_i \sim f_{e[i]}( g_{e[i]}^{-1} (p_{\mathrm 1,i}, p_{\mathrm 2,i}),
\theta_{e[i]} )
\]</span></p>
<p>where</p>
<ul>
<li><span class="math inline">\(f_{e[i]}\)</span> probability density or
mass function for sample <span class="math inline">\(i\)</span>;</li>
<li><span class="math inline">\(g_{e[i]}^{-1} (p_{\mathrm 1,i},
p_{\mathrm 2,i})\)</span> is the bivariate inverse-link function that
transforms linear predictors to the central tendancy parameters of the
distribution;</li>
<li><span class="math inline">\(\theta_{e[i]}\)</span> is the dispersion
parameters for distribution <span class="math inline">\(e[i]\)</span>
for sample <span class="math inline">\(i\)</span>;</li>
</ul>
<p>In the simple case, the distribution only requires a single linear
predictor such that <span class="math inline">\(\mathbf p_{\mathrm 2} =
\mathbf 0\)</span> by construction and drops out of the model. In this
case, the model collapses to a generalized linear mixed model. For
example we might have a log-link and Poisson distribution, such that it
collapses to a log-linked Poisson GLMM, <span class="math inline">\(y_i
\sim \mathrm{Poisson}(e^{p_{\mathrm 1,i}})\)</span>.</p>
<p>However, tinyVAST can also handle a delta-model using either
logit-log or Poisson-linked link functions:</p>
<p><span class="math display">\[
g_{e[i]}^{-1} (p_{\mathrm 1,i}, p_{\mathrm 2,i}) = ( \mu_{\mathrm 1,i},
\mu_{\mathrm 2,i}  )
\]</span></p>
<p>where <span class="math inline">\(\mu_{\mathrm 1,i}\)</span> and
<span class="math inline">\(\mu_{\mathrm 2,i}\)</span> are the two
linear predictors, such that <span class="math inline">\(\mathbb{E}[y_i]
= \mu_{\mathrm 1,i} \mu_{\mathrm 2,i}\)</span>;</p>
<p>For the conventional logit-log bivariate link function we use a
logit-link for encounter probabilities and a log-link for positive catch
rates:</p>
<p><span class="math display">\[
\begin{aligned}
\mu_{\mathrm 1,i} &amp;= \frac{e^{p_{\mathrm 1,i}}}{1+e^{p_{\mathrm
1,i}}}  \\
\mu_{\mathrm 2,i} &amp;= e^{p_{\mathrm 2,i}}
\end{aligned}
\]</span></p>
<p>while for the Poisson-linked link function we specify a complemetary
log-log link for encounter probabilities and define the second link
function such that <span class="math inline">\(\mu_{\mathrm 1,i}
\mu_{\mathrm 2,i} = e^{p_{\mathrm 1,i}} e^{p_{\mathrm
2,i}}\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
\mu_{\mathrm 1,i} &amp;= 1 - e^{-e^{p_{\mathrm 1,i}}} \\
\mu_{\mathrm 2,i} &amp;= \frac{e^{p_{\mathrm 1,i}}}{\mu_{\mathrm 1,i}}
e^{p_{\mathrm 2,i}}
\end{aligned}
\]</span> where <span class="math inline">\(e^{p_{\mathrm 1,i}}\)</span>
is the density for an underlying point process, and <span class="math inline">\(e^{p_{\mathrm 2,i}}\)</span> is biomass per point
(i.e., animal or group).</p>
<p>In either the conventional or Poisson-linked delta model, <span class="math inline">\(\mu_{\mathrm 1,i} = \mathrm{Pr}(Y&gt;0)\)</span>
is the encounter probability (and is fitted with a Bernoulli
distribution), while <span class="math inline">\(\mu_{\mathrm
2,i}\)</span> is the central tendancy for positive values, i.e., <span class="math inline">\(\mu_{\mathrm 2,i} = \mathbb{E}(Y |
Y&gt;0)\)</span>.</p>
</div>
<div id="spatial-domains" class="section level1">
<h1>Spatial domains</h1>
<p>Linear predictors include spatially autocorrelated latent variables.
These variables are treated as Gaussian Markov random fields (GMRFs),
and evaluating the probability density of GMRFs involves calculating the
precision matrix <span class="math inline">\(\mathbf Q_{\mathrm{domain}}
= \mathbf\Sigma^{-1}\)</span> as the inverse of the spatial covariance
matrix. tinyVAST involves three options for specifying this spatial
precision:</p>
<ul>
<li>Stochastic partial differentiaul equation (SPDE): The analyst can
approximate spatial variation over a continuous two-dimensional surface
by constructing finite element mesh (FEM), treating the value at
vertices as a GMRF, and then using bilinear interpolation (i.e., a
piecewise linear approximation) to interpolate from vertices to the
spatial domain. In this case, the precision is constructred as:</li>
</ul>
<p><span class="math display">\[
\mathbf Q_{\mathrm{domain}} = \tau^2 ( \kappa^4 \mathbf M_{\mathrm 0} +
2\kappa^2 \mathbf M_{\mathrm 1} + \mathbf M_{\mathrm 2} )
\]</span> where every row <span class="math inline">\(\mathbf
A_i\)</span> of the interpolation matrix <span class="math inline">\(\mathbf A\)</span> is nonzero for only the three
vertices of the triangle that contains sample <span class="math inline">\(i\)</span></p>
<ul>
<li>Simultaneous autoregressive (SAR): Alternatively, the analyst can
specify an areal model representing the value within spatial
strata:</li>
</ul>
<p><span class="math display">\[
\mathbf Q_{\mathrm{domain}} = \tau^2 (\mathbf I - \kappa \mathbf A^*)^2
\]</span> where <span class="math inline">\(\mathbf A^*\)</span> is the
adjacency matrix of the graph specified by the analyst, and each row
<span class="math inline">\(\mathbf A_i\)</span> of interpolation matrix
<span class="math inline">\(\mathbf A\)</span> is nonzero only for the
single spatial stratum containing sample <span class="math inline">\(i\)</span> (and noting that adjacency matrix <span class="math inline">\(\mathbf A^*\)</span> is different from
interpolation matrix <span class="math inline">\(\mathbf A\)</span>, but
we use the same notation for both due to a collision in notational
standards).</p>
<ul>
<li>Stream networks: Finally, the analyst can specify that sites are
partially correlated if they are adjacent along a stream network (while
ignoring flow direction). This results in an Onstein-Uhlenbeck process
along the stream network, or an <em>exponential tail-down</em>
model.</li>
</ul>
<p>For each spatial domain, the term <span class="math inline">\(\tau\)</span> is defined such that precision <span class="math inline">\(\mathbf Q_{\mathrm{domain}}\)</span> has unit
variance. This is done because the spatial domain always arises in
combination with other parameters, which are used to define the variance
of the associated spatial variable.</p>
</div>
<div id="structural-equation-models" class="section level1">
<h1>Structural equation models</h1>
<p>tinyVAST also involves specifying a structural equation model (SEM).
This SEM be viewed either:</p>
<ol style="list-style-type: decimal">
<li><em>Weak interpretation</em>: as an expressive interface to
parameterize the correlation among variables, using as many or few
parameters as might be appropriate; or</li>
<li><em>Strong interpretation</em>: as a structural causal model,
allowing predictions about the consequence of counterfactual changes to
the system.</li>
</ol>
<p>To specify a SEM, the user uses <em>arrow notation</em> derived from
package <code>sem</code>. For example, to specify a linear model this
involves:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>w1 <span class="ot">-&gt;</span> w2, b_12</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>w1 <span class="ot">&lt;-</span><span class="er">&gt;</span> w1, sd_1</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>w2 <span class="ot">&lt;-</span><span class="er">&gt;</span> w2, sd_2</span></code></pre></div>
<p>This then estimates a single slope parameter (represented with a
one-headed arrow), as well as the variance of <span class="math inline">\(W_1\)</span> and <span class="math inline">\(W_2\)</span> (specified with two-headed arrows).
In a more complicated case, <span class="math inline">\(W_1\)</span>
might cause <span class="math inline">\(W_2\)</span>, which in turn
causes <span class="math inline">\(W_3\)</span>. This is then
represented as:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># Path, parameter_name, start value</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>w1 <span class="ot">-&gt;</span> w2, b_12, <span class="dv">0</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>w2 <span class="ot">-&gt;</span> w3, b_23, <span class="dv">0</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>w1 <span class="ot">&lt;-</span><span class="er">&gt;</span> w1, s_1, <span class="dv">1</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>w2 <span class="ot">&lt;-</span><span class="er">&gt;</span> w2, s_2, <span class="dv">1</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>w3 <span class="ot">&lt;-</span><span class="er">&gt;</span> w3, s_3, <span class="dv">1</span></span></code></pre></div>
<p>SEM interactions can be as complicated or simple as desired, and can
include:</p>
<ol style="list-style-type: decimal">
<li>Latent variables and loops (i.e., they are not restricted to
directed acyclic graphs);</li>
<li>Values that are fixed a priori, where the
<code>parameter_name</code> is provided as <code>NA</code> and the
starting value that follows is the fixed value;</li>
<li>Values that are mirrored among path coefficients, where the same
<code>parameter_name</code> is provided for multiple rows of the text
file.</li>
</ol>
<p>In this preceding example, path coefficients for one-headed arrows
then define path matrix <span class="math inline">\(\mathbf
P\)</span>:</p>
<p><span class="math display">\[
\mathbf P =
\begin{pmatrix}
  0 &amp; 0 &amp; 0 \\
  b_{12} &amp; 0 &amp; 0 \\
  0 &amp; b_{23} &amp; 0
\end{pmatrix}
\]</span></p>
<p>and coefficents for two-headed arrows define the Cholesky <span class="math inline">\(\mathbf G\)</span> of the exnogenous covariance
matrix <span class="math inline">\(\mathbf G^T \mathbf G\)</span>:</p>
<p><span class="math display">\[
\mathbf G =
\begin{pmatrix}
  s_{1} &amp; 0 &amp; 0 \\
  0 &amp; s_{2} &amp; 0 \\
  0 &amp; 0 &amp; s_{3}
\end{pmatrix}
\]</span></p>
<p>These matrices are define a simultaneous equation model:</p>
<p><span class="math display">\[
\mathbf{ w = P w + \epsilon} \\
\mathbf\epsilon \sim \mathrm{MVN}( \mathbf 0, \mathbf G^T \mathbf G )
\]</span> where the variance <span class="math inline">\(\mathrm{Var}(\mathbf w) = (\mathbf{I - P})^{-1}
\mathbf G^2 (\mathbf{I - P}^T)^{-1}\)</span>. This then results in a
sparse precision matrix:</p>
<p><span class="math display">\[
\mathbf Q = (\mathbf{I - P}^T) \mathbf G^{-1} \mathbf G^{-T} (\mathbf{I
- P})
\]</span></p>
<p>where this precision matrix <span class="math inline">\(\mathbf
Q\)</span> is then used as a modular component in the larger tinyVAST
model.</p>
</div>
<div id="dynamic-structural-equation-models" class="section level1">
<h1>Dynamic structural equation models</h1>
<p>Similarly, tinyVAST involves specifying dynamic structural equation
models (DSEM). To specify a DSEM, the user uses <em>arrow-and-lag
notation</em>. For example, to specify a univariate first-order
autoregressive process:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>w1 <span class="ot">-&gt;</span> w1, <span class="dv">1</span>, rho, <span class="fl">0.8</span></span></code></pre></div>
<p>If there were four time-intervals (<span class="math inline">\(T=4\)</span>) this would then result in the path
matrix:</p>
<p><span class="math display">\[
\mathbf P =
\begin{pmatrix}
  0 &amp; 0 &amp; 0 &amp; 0 \\
  \rho &amp; 0 &amp; 0 &amp; 0 \\
  0 &amp; \rho &amp; 0 &amp; 0 \\
  0 &amp; 0 &amp; \rho &amp; 0
\end{pmatrix}
\]</span></p>
<p>and when the DSEM involves multiple times and variables, the sparse
precision is formed by summing across the Kronecker product of time-lag
and interaction matrices. This DSEM defines a GMRF over a nonseparable
interaction of time and variables, represented by a matrix <span class="math inline">\(\mathbf Q_{\mathrm{time\_term}}\)</span> with
dimension <span class="math inline">\(CT \times CT\)</span>. The user
can specify a separate <em>arrow-and-lag</em> notation to define the
precision matrix for the time-variable interaction <span class="math inline">\(\mathbf Q_{\mathrm{time\_term}}\)</span> and for
the space-time-variable interaction <span class="math inline">\(\mathbf
Q_{\mathrm{spacetime\_term}}\)</span>.</p>
<p>The precision matrix <span class="math inline">\(\mathbf
Q_{\mathrm{time\_term}}\)</span> for the time term <span class="math inline">\(\mathbf D\)</span> is used to define the
time-varying intercept for each variable:</p>
<p><span class="math display">\[
\mathrm{vec}(\mathbf D) \sim \mathrm{MVN}(\mathbf 0, \mathbf
Q_{\mathrm{time\_term}})
\]</span> Meanwhile, the space-time term <span class="math inline">\(\mathbf Q_{\mathrm{spacetime\_term}}\)</span> is
combined with the spatial precision <span class="math inline">\(\mathbf
Q_{\mathrm{space\_term}}\)</span> as we explain next.</p>
</div>
<div id="spatial-interactions-for-sem-and-dsem" class="section level1">
<h1>Spatial interactions for SEM and DSEM</h1>
<p>tinyVAST uses the SEM and DSEM notation to construct the joint
precision for the space-variable interaction <span class="math inline">\(\mathbf\Omega\)</span> with dimension <span class="math inline">\(S \times C\)</span>, and the space-time-variable
interaction <span class="math inline">\(\mathbf E\)</span> with
dimension <span class="math inline">\(S \times C \times T\)</span>. To
do so, it constructs the separable precision for each process:</p>
<p><span class="math display">\[
\mathrm{vec}(\mathbf E) \sim \mathrm{MVN}(\mathbf 0, \mathbf
Q_{\mathrm{spacetime\_term}} \otimes \mathbf Q_{\mathrm{domain}})
\]</span></p>
<p>where the precision matrix <span class="math inline">\(\mathbf
Q_{\mathrm{spacetime\_term}} \otimes \mathbf
Q_{\mathrm{domain}}\)</span> has dimension <span class="math inline">\(STC \times STC\)</span> to match the length of
<span class="math inline">\(\mathrm{vec}(\mathbf E)\)</span>, and <span class="math display">\[
\mathrm{vec}(\mathbf\Omega) \sim \mathrm{MVN}(\mathbf 0, \mathbf
Q_{\mathrm{space\_term}} \otimes \mathbf Q_{\mathrm{domain}})
\]</span></p>
<p>where the precision matrix <span class="math inline">\(\mathbf
Q_{\mathrm{space\_term}} \otimes \mathbf Q_{\mathrm{domain}}\)</span>
has dimension <span class="math inline">\(SC \times SC\)</span>, to
match the length of <span class="math inline">\(\mathrm{vec}(\mathbf\Omega)\)</span>.</p>
</div>
<div id="generalized-additive-model" class="section level1">
<h1>Generalized additive model</h1>
<p>Finally, the analyst can specify a generalized additive model using
syntax from package mgcv. For example this might involve:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>count <span class="sc">~</span> year <span class="sc">+</span> <span class="fu">offset</span>(log_area) <span class="sc">+</span> <span class="fu">s</span>(depth) <span class="sc">+</span> <span class="fu">s</span>(species, <span class="at">bs=</span><span class="st">&quot;re&quot;</span>)</span></code></pre></div>
<p>If <code>year</code> and <code>species</code> are factors and
<code>depth</code> and <code>log_area</code> are continuous, then this
would specify a fixed effect for each level <code>year</code>, a spline
smoother for <code>depth</code>, using <code>log_area</code> as an
offset, and estimating a random intercept for each level of
<code>species</code>. This formula is parsed internally to assemble
fixed effects in design matrix <span class="math inline">\(\mathbf
X\)</span> and the basis functions for spline smoothers and random
effects in design matrix <span class="math inline">\(\mathbf Z\)</span>.
The coefficients <span class="math inline">\(\mathbf\gamma\)</span>
associated with smoothers and random effects are then specified to
follow a GMRF:</p>
<p><span class="math display">\[
\mathbf\gamma \sim \mathrm{GMRF}( \mathbf 0, \mathbf Q_{\mathrm{gam}})
\]</span> where <span class="math inline">\(\mathbf
Q_{\mathrm{gam}}\)</span> is a blockwise diagonal matrix, assembled from
estimated variance parameters and matrices constructed by mgcv.</p>
<table>
<caption>Table 1: Subscript notation</caption>
<thead>
<tr class="header">
<th align="left">Symbol</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><span class="math inline">\(i\)</span></td>
<td align="left">Index for each sample, <span class="math inline">\(i\)</span> in <span class="math inline">\((1,2,...,I)\)</span></td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(s[i]\)</span></td>
<td align="left">spatial coordinate for sample <span class="math inline">\(i\)</span>, <span class="math inline">\(s\)</span>
in <span class="math inline">\((1,2,...,S)\)</span></td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(t[i]\)</span></td>
<td align="left">time-interval for sample <span class="math inline">\(i\)</span>, <span class="math inline">\(t\)</span>
in <span class="math inline">\((1,2,...,T)\)</span></td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(c[i]\)</span></td>
<td align="left">category for sample <span class="math inline">\(i\)</span>, <span class="math inline">\(c\)</span>
in <span class="math inline">\((1,2,...,C)\)</span></td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(e[i]\)</span></td>
<td align="left">error distribution and link function for sample <span class="math inline">\(i\)</span></td>
</tr>
</tbody>
</table>
<table>
<caption>Table 2: Symbol notation, code representation (in model output
or in model template code), and descriptions.</caption>
<thead>
<tr class="header">
<th align="left">Symbol</th>
<th align="left">Code</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><span class="math inline">\(y\)</span></td>
<td align="left"><code>y_i</code></td>
<td align="left">Observed response data</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(p_1\)</span></td>
<td align="left"><code>p_i</code></td>
<td align="left">first linear predictor</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(p_2\)</span></td>
<td align="left"><code>p2_i</code></td>
<td align="left">second linear predictor</td>
</tr>
</tbody>
</table>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
